<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>360¬∞ Street View with Video Banner</title>
<style>
html, body {
  margin: 0;
  height: 100%;
  overflow: hidden;
  background: #000;
  font-family: Arial, sans-serif;
}
canvas { display: block; }
#transitionOverlay {
  position: fixed;
  inset: 0;
  background: radial-gradient(circle at center, transparent 20%, #000 80%);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.8s ease;
  z-index: 10;
}
.nav-btn {
  position: fixed;
  bottom: 24px;
  width: 140px;
  height: 54px;
  background: rgba(20,40,80,0.9);
  color: #fff;
  border: 1px solid rgba(120,180,255,0.6);
  border-radius: 14px;
  font-size: 18px;
  font-weight: bold;
  cursor: pointer;
  backdrop-filter: blur(10px);
  z-index: 15;
}
#prevBtn { left: 24px; }
#nextBtn { right: 24px; }
.zoom-btn {
  position: fixed;
  right: 24px;
  width: 54px;
  height: 54px;
  background: rgba(20,40,80,0.9);
  color: #fff;
  border: 1px solid rgba(120,180,255,0.6);
  border-radius: 50%;
  font-size: 26px;
  font-weight: bold;
  cursor: pointer;
  backdrop-filter: blur(10px);
  z-index: 15;
}
#zoomIn { bottom: 100px; }
#zoomOut { bottom: 160px; }
#soundBtn {
  position: fixed;
  top: 24px;
  right: 24px;
  padding: 12px 18px;
  border-radius: 12px;
  background: rgba(20,40,80,0.9);
  color: #fff;
  border: 1px solid rgba(120,180,255,0.6);
  cursor: pointer;
  z-index: 20;
}
</style>
</head>
<body>

<div id="transitionOverlay"></div>
<button id="prevBtn" class="nav-btn">‚Üê Back</button>
<button id="nextBtn" class="nav-btn">Forward ‚Üí</button>
<button id="zoomIn" class="zoom-btn">+</button>
<button id="zoomOut" class="zoom-btn">‚àí</button>
<button id="soundBtn">üîá Sound Off</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
<script>

const panoramas = [
  {
    url: "https://raw.githubusercontent.com/Gitboi46/360-viewer/main/Panorama3_Configuration1_BJP.jpg",
    forward: 1,
    backward: 7,
    hasVideo: true
  },
  {
    url: "https://raw.githubusercontent.com/Gitboi46/360-viewer/main/Panorama4.png",
    forward: 2,
    backward: 0
  },
  {
    url: "https://raw.githubusercontent.com/Gitboi46/360-viewer/main/Panorama5.png",
    forward: 3,
    backward: 1
  },
  {
    url: "https://raw.githubusercontent.com/Gitboi46/360-viewer/main/Panorama3.png",
    forward: 4,
    backward: 2
  },
  {
    url: "https://raw.githubusercontent.com/Gitboi46/360-viewer/main/Panorama4.png",
    forward: 5,
    backward: 3
  },
  {
    url: "https://raw.githubusercontent.com/Gitboi46/360-viewer/main/Panorama6.png",
    forward: 6,
    backward: 4
  },
  {
    url: "https://raw.githubusercontent.com/Gitboi46/360-viewer/main/Panorama7.png",
    forward: 7,
    backward: 5
  },
  {
    url: "https://raw.githubusercontent.com/Gitboi46/360-viewer/main/Panorama9.png",
    forward: 0,
    backward: 6
  }
];

let scene, camera, renderer, sphere;
let yaw = 0, pitch = 0;
let currentIndex = 0;
let isDragging = false;
let videoMesh = null;
let videoElement = null;
let videoTexture = null;

const overlay = document.getElementById("transitionOverlay");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");
const zoomInBtn = document.getElementById("zoomIn");
const zoomOutBtn = document.getElementById("zoomOut");
const soundBtn = document.getElementById("soundBtn");

init();
animate();

prevBtn.onclick = () => move(false);
nextBtn.onclick = () => move(true);
zoomInBtn.onclick = () => zoom(-5);
zoomOutBtn.onclick = () => zoom(5);
soundBtn.onclick = toggleSound;

function init() {
  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera(75, innerWidth / innerHeight, 0.1, 2000);
  renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(innerWidth, innerHeight);
  renderer.setPixelRatio(devicePixelRatio);
  document.body.appendChild(renderer.domElement);

  loadPanorama(0);

  renderer.domElement.addEventListener("pointerdown", userGesture);
  renderer.domElement.addEventListener("pointermove", onPointerMove);
  renderer.domElement.addEventListener("pointerup", () => isDragging = false);
  renderer.domElement.addEventListener("wheel", e => zoom(e.deltaY * 0.02));
  window.addEventListener("resize", onResize);
}

function userGesture() {
  if (videoElement && videoElement.paused) {
    videoElement.play().catch(()=>{});
  }
  isDragging = true;
}

function loadPanorama(index) {
  new THREE.TextureLoader().load(panoramas[index].url, tex => {

    if (!sphere) {
      const geo = new THREE.SphereGeometry(500, 64, 48);
      geo.scale(-1, 1, 1);
      sphere = new THREE.Mesh(
        geo,
        new THREE.MeshBasicMaterial({ map: tex })
      );
      scene.add(sphere);
    } else {
      sphere.material.map = tex;
      sphere.material.needsUpdate = true;
    }

    removeVideoBanner();
    if (panoramas[index].hasVideo) addVideoBanner();

    currentIndex = index;
  });
}

function addVideoBanner() {

  videoElement = document.createElement("video");
  videoElement.src = "https://raw.githubusercontent.com/Gitboi46/360-viewer/main/Sakshi%20Intro%20Blue%20Screen.mp4";
  videoElement.crossOrigin = "anonymous";
  videoElement.loop = true;
  videoElement.muted = true;
  videoElement.preload = "auto";
  videoElement.playsInline = true;
  videoElement.setAttribute("playsinline", "");
  videoElement.setAttribute("webkit-playsinline", "");

  videoElement.addEventListener("canplaythrough", () => {

    videoTexture = new THREE.VideoTexture(videoElement);
    videoTexture.minFilter = THREE.LinearFilter;
    videoTexture.magFilter = THREE.LinearFilter;
    videoTexture.format = THREE.RGBAFormat;

    const geometry = new THREE.PlaneGeometry(200, 335);
    const material = new THREE.MeshBasicMaterial({
      map: videoTexture,
      side: THREE.DoubleSide
    });

    videoMesh = new THREE.Mesh(geometry, material);
    videoMesh.position.set(-360, 10, 25);
    videoMesh.rotation.y = THREE.MathUtils.degToRad(80);
    scene.add(videoMesh);

    videoElement.play().catch(()=>{});
  });

  videoElement.load();
}

function removeVideoBanner() {
  if (!videoMesh) return;
  scene.remove(videoMesh);
  if (videoElement) videoElement.pause();
  videoMesh = null;
  videoElement = null;
}

function toggleSound() {
  if (!videoElement) return;
  videoElement.muted = !videoElement.muted;
  if (!videoElement.muted) videoElement.play().catch(()=>{});
  soundBtn.textContent = videoElement.muted ? "üîá Sound Off" : "üîä Sound On";
}

function move(forward) {
  const target = forward
    ? panoramas[currentIndex].forward
    : panoramas[currentIndex].backward;

  loadPanorama(target);
}

function onPointerMove(e) {
  if (!isDragging) return;
  yaw -= e.movementX * 0.25;
  pitch -= e.movementY * 0.25;
  pitch = Math.max(-85, Math.min(85, pitch));
}

function zoom(amount) {
  camera.fov = THREE.MathUtils.clamp(camera.fov + amount, 30, 90);
  camera.updateProjectionMatrix();
}

function onResize() {
  camera.aspect = innerWidth / innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
}

function animate() {
  requestAnimationFrame(animate);
  camera.rotation.order = "YXZ";
  camera.rotation.y = THREE.MathUtils.degToRad(yaw);
  camera.rotation.x = THREE.MathUtils.degToRad(pitch);

  if (videoTexture) videoTexture.needsUpdate = true;

  renderer.render(scene, camera);
}
</script>
</body>
</html>
